# NagAudio Server Code
> Теория - это когда вы знаете все, но ничего не работает. Практика - это когда все работает, но никто не знает почему. В этом проекте мы совместили теорию и практику - ничего не работает и никто не знает почему.@Неизвестный мудрец

### Оглавление
1. [Установка](#Установка)
2. [Дорожная карта](#Дорожная-карта)
3. [API сервера для разработчиков](#API-сервера)

### Установка
Сделаю потом.
### Дорожная карта
:white_check_mark: База сервера
:white_check_mark: Базовый функционал плеера
:black_square_button: Показ текущего плейлиста
:black_square_button: Обновление текущей песни в плеере
:black_square_button: Показ процесса воспроизведения
:black_square_button: Работа с файлами
:black_square_button: Работа с плейлистами
:black_square_button: Базовый фикс багов
### API сервера
**Предназначено для Web клиента и сторонних приложений**

------------

Базовый url
```
http://{host}/api
```

------------
#### Управление плеером (WebSocket)

- Подключение к плееру(пример)
```javascript
var ws = new Websocket("ws://{host}/api/player/ws");
````
Ответ:
```json
//ws.onmessage data
{
	type: "start",
	value: {
		music:{
			file: "Путь к файлу",
			last-modified: "Дата изменения",
			artist: "Создатель",
			title: "Название",
			album: "Альбом",
			date: "Дата создания",
			time: "Время воспроизведения",
			duration: "Чуть более точное время воспроизведения",
			pos: "Позиция в плейлисте",
			id: "ID трека"
		}
		status:{
			volume: "Текущая громкость",
			repeat: "Повтор плейлиста(0/1)",
			random: "Рандомное воспроизведение(0/1)",
			single: "Повтор трека(0/1)",
			consume: "0/1",
			playlist: "id плейлиста",
			playlistlength: "Длина плейлиста в колличестве треков",
			mixrampdb: "Db",
			state: "Состояние воспроизведения",
			song: "Позиция в плейлисте",
			songid: "ID трека",
			time: "Время воспроизведения(прошло времени:всего времени)",
			elapsed: "Болле точное время воспроизведения",
			bitrate: "Битрейт",
			duration: "Общее время трека",
			audio: "bis:channel",
			nextsong: "Позиция следующего трека в плейлисте",
			nextsongid: "ID следующего трека в плейлисте ",
		}
	}
}
````

------------

- Переключение состояния воспроизведения
Запроc/Успешный ответ(отправляется сразу всем подключенным пользователям)
```json
{
	type: "state",
	value: "stop/pause/play"
}
```

------------

- Переключение музыки вперед/назад
Клиент остается без ответа, сервер отдельно уведомляет о смене трека
```json
{
	type: "next/prev",
	value: "1"
}
```

------------

- Смена громкости
Запроc/Успешный ответ(отправляется сразу всем подключенным пользователям)
```json
{
	type: "volume",
	value: "Значение громкости(0-100)"
}
```

------------

- Переключение повтора плейлиста
Запроc/Успешный ответ(отправляется сразу всем подключенным пользователям)
```json
{
	type: "repeat",
	value: "0/1"
}
```

------------

- Переключение рандомного воспроизведения  треков
Запроc/Успешный ответ(отправляется сразу всем подключенным пользователям)
```json
{
	type: "shuffle",
	value: "0/1"
}
```

------------

#### Управление файлами и плейлистами

- Список файлов
Получение списка папок в папке, указанной в конфиге mpd
```
/dirs
```
JSON ответ
```json
{
	{
		directory: "Название папки",
		last-modified: "Дата последнего изменения"
	},
	...........
}
```

------------

- Текущий список воспроизведения
Показывает текущий список треков
```
/playlists/current
```
JSON ответ
```json
{
	{
	file: "Путь к файлу",
	last-modified: "Дата изменения",
	artist: "Создатель",
	title: "Название",
	album: "Альбом",
	date: "Дата создания",
	time: "Время воспроизведения",
	duration: "Чуть более точное время воспроизведения",
	pos: "Позиция в плейлисте",
	id: "ID трека"
	}
	......
}
```